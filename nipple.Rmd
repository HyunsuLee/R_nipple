---
title: "Nipple"
author: "Hyunsu Lee"
date: "April 30, 2016"
output: html_document
---

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

## Data load & summary
```{r, echo=FALSE}
require(ggplot2)
nipple <- read.csv("nippleKrp_Wt.csv", header = TRUE)
##head(nipple)
```

## Data subsetting
```{r, echo=FALSE}

nipplefulvar <- colnames(nipple)
nipplesubvar <- nipplefulvar[1:14]
nipplesub <- nipple[nipplesubvar]
colnames(nipplesub) <- c("id","krp1", "krp2", "krp3", "wt1", "wt2","wt3","der_avr","wt_avr", "krp_avr","Fold_change", "gene.acc","gene.symbol","gene.desc")
nipplesub.t <-data.frame(t(nipplesub[2:7])) # matrix transpose, col에 gene, raw에 실험이 가도록
colnames(nipplesub.t) <- nipplesub$gene.symbol # column name을 gene symbol로 바꿈.
# 이 아래쪽은 fold change가 큰 gene들, 즉 DEG에 대해서만 PCA를 할 경우 사용.
# nipplesub.deg <- subset(nipplesub, Fold_change > 1.5 | Fold_change <0.67)
# nipplesub.deg.t <-t(nipplesub.deg[2:7])
# gene.sym.deg <- nipplesub.deg$gene.symbol
# colnames(nipplesub.deg.t) <- gene.sym.deg
```

## PCA
```{r, echo=FALSE}
nipple.pca <- prcomp(nipplesub.t, scale. =TRUE) # PCA 시행.
summary(nipple.pca)
# screeplot(nipple.pca) PC들의 분산들에 대해 plot. 이것 보단 variance propotion이 나은듯.
nipple.pca.var = nipple.pca$sdev ^ 2 # 주성분들의 분산 계산
nipple.pca.pve = nipple.pca.var / sum(nipple.pca.var) #주성분 분산의 propotion 계산
plot (nipple.pca.pve, xlab = "Principal Component", ylab = "Propotion of Variance Explained", ylim = c(0,0.4), type = "b")
nipple.pca.scores = data.frame(nipple.pca$x) #PC들만 따로 뽑기.

group <- factor(c("KrP", "KrP", "KrP", "WT","WT","WT")) # gene group naming
rep <- factor(c("Rep1", "Rep2", "Rep3","Rep1", "Rep2", "Rep3" )) # replication naming
nipple.pca.scores <- cbind(nipple.pca.scores, group, rep) # PC matrix에 data labeling

#graph 그리기
ggplot(nipple.pca.scores, aes(PC1, PC2)) + 
  # point layer 추가, 이중 point 로 그림 그리기
  geom_point(aes(color=group), size = 4) +
  geom_point(color="#FFFFFF", size = 1.5, show.legend = TRUE) +
  # Point 오른쪽에 text 추가
  geom_text(aes(label=rep, color= group), size =5, nudge_x= 25, show.legend = FALSE) +
  # 배경을 하얀색으로, axis label size과 title size 조절
  theme_bw() + theme(axis.text =element_text(size = rel(1.2))) +
  theme(axis.title=element_text(size=rel(1.5))) +
  # legend tilte없애고, box를 하얀색으로 안보이게, legend size조절.
  theme(legend.title=element_blank(),legend.key = element_rect(color = "#FFFFFF"), legend.text = element_text(size = rel(1.2) ))

```


